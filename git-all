#!/bin/sh
# Locate directories under $HOME which are Git-controlled and have uncommitted
# changes.
# Ignore some paths that cause errors to be printed, or are not of interest
PRUNE="-path */.cache* -o -path *.dbus -o -path ./vc/Dropbox"
if [ -z "$1" ]; then
  BASE=$HOME
else
  BASE=$1
fi
for d in $(find $BASE -type d \( $PRUNE \) -prune -o -name .git -print); do
  changed=$(git --git-dir=$d --work-tree=$(dirname $d) status -z | sort -z | cut -zc1-2 | uniq -cz)
  if [ -n "$changed" ]; then
    echo $(dirname $d) "\n$changed"
  fi
done
